{"version":3,"file":"static/js/5022.279d7a7a.chunk.js","mappings":"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","sources":["services/tmdb/cache.js","services/tmdb/tmdbSrv.js"],"sourcesContent":["import { setProp, getProp } from 'utils';\n\nexport default class Cache {\n  #cache = {};\n\n  set(path, value) {\n    setProp(this.#cache, path, value);\n  }\n\n  get(path) {\n    return getProp(this.#cache, path);\n  }\n\n  get data() {\n    return { ...this.#cache };\n  }\n\n  clear() {\n    this.#cache = {};\n  }\n}\n","import axios from 'axios';\nimport { isObj, isArray, camelToSnake, normalizeStr } from '../../utils';\nimport Cache from './cache';\n\nconst cache = new Cache();\nlet controller;\n\nconst data = {\n  API_BASE_URL: 'https://api.themoviedb.org/3',\n  IMAGE_BASE_URL: 'https://image.tmdb.org/t/p',\n  TMDB_BASE_URL: 'https://www.themoviedb.org/movie',\n  IMDB_BASE_URL: 'https://www.imdb.com/title',\n  API_KEY: '86d04e898c465c8de09e1ea2fc383ab8',\n};\n\n//\n// TmdbService\n//\n\nexport default class TmdbService {\n  #response;\n  #instance;\n\n  constructor() {\n    if (this.#instance) return this.#instance;\n    this.#instance = this;\n  }\n\n  /**\n   *\n   * @param {*} relPath\n   * @param {*} size\n   * @returns\n   */\n  getImageUrl(relPath, size) {\n    const sz = isNaN(parseInt(size)) ? 'original' : `w${size}`;\n    return `${data.IMAGE_BASE_URL}/${sz}/${relPath}`;\n  }\n\n  getTmdbUrl(id) {\n    return `${data.TMDB_BASE_URL}/${id}`;\n  }\n\n  getImdbUrl(imdbId) {\n    return `${data.IMDB_BASE_URL}/${imdbId}`;\n  }\n\n  /**\n   *\n   * @param {*} url\n   * @returns\n   */\n  async fetch(url) {\n    controller = new AbortController();\n    const { signal } = controller;\n\n    try {\n      const resp = await axios.get(url, { signal });\n      return { ...(this.#response = resp) };\n      // error\n    } catch (err) {\n      this.#response = err;\n      throw err;\n    }\n  }\n\n  /**\n   *\n   * @param {*} path\n   * @param {*} params\n   * @returns\n   */\n  async get(path, params) {\n    const url = `${data.API_BASE_URL}/${path}?api_key=${\n      data.API_KEY\n    }&${new URLSearchParams(namesToSnake(params))}`;\n\n    return await this.fetch(url);\n  }\n\n  /**\n   *\n   * @param {array} ids - массив идентификаторов жанра\n   * @returns массив названий жанра для каждого идентификатора\n   */\n  async getGenres(ids) {\n    if (!isArray(ids)) return [];\n\n    if (!cache.get('genres')) {\n      const resp = await this.get(`genre/movie/list`);\n      cache.set('genres', resp.data.genres);\n    }\n\n    return cache\n      .get('genres')\n      .filter(({ id }) => ids.includes(id))\n      .map(({ name }) => name);\n  }\n\n  /**\n   *\n   * @param {*} period\n   * @param {*} params\n   * @returns\n   */\n  async getTrendingMovies(period, params) {\n    // не кешируем - грузятся страницами\n    const { data } = await this.get(\n      `trending/movie/${normalizeStr(period)}`,\n      params\n    );\n\n    return data;\n  }\n\n  /**\n   *\n   * @param {*} id\n   * @param {*} params\n   * @returns\n   */\n  async getMovieDetails(id, params) {\n    const cached = cache.get(`movie/${id}`);\n    if (cached) return cached;\n\n    const { data } = await this.get(`movie/${id}`, params);\n    cache.set(`movie/${id}`, data);\n\n    return data;\n  }\n\n  async getMovieCredits(id, params) {\n    const cached = cache.get(`movie/${id}/credits`);\n    if (cached) return cached;\n\n    const { data } = await this.get(`movie/${id}/credits`, params);\n    cache.set(`movie/${id}/credits`, data);\n\n    return data;\n  }\n\n  // не кешируем - грузятся страницами\n  async getMovieReviews(id, params) {\n    const { data } = await this.get(`movie/${id}/reviews`, params);\n    return data;\n  }\n\n  async searchMovies(query, params) {\n    const { data } = await this.get(`search/movie`, { query, ...params });\n    return data;\n  }\n\n  get cache() {\n    return cache.data;\n  }\n\n  abort() {\n    // controller.abort();\n  }\n}\n\n/**\n *\n * @param {object} obj\n * @returns - копию obj с именами свойств в snake_case\n */\nfunction namesToSnake(obj) {\n  return isObj(obj)\n    ? Object.entries(obj).reduce((res, [name, val]) => {\n        res[camelToSnake(name)] = val;\n        return res;\n      }, {})\n    : {};\n}\n"],"names":["Cache","path","value","setProp","this","getProp","controller","cache","data","TmdbService","relPath","size","sz","isNaN","parseInt","id","imdbId","url","AbortController","signal","axios","resp","params","URLSearchParams","obj","isObj","Object","entries","reduce","res","name","val","camelToSnake","fetch","ids","isArray","get","set","genres","filter","includes","map","period","normalizeStr","cached","query"],"sourceRoot":""}